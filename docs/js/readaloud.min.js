function restrictValue(e,n,t,a){return isNaN(e)?a:Math.min(Math.max(e,n),t)}function Slider(e){function n(){var n=e.scrollLeft;e.scrollLeft=e.scrollWidth;var t=e.scrollLeft;return e.scrollLeft=n,t}var t=$(e).data("min"),a=$(e).data("max");this.getValue=function(){return e.scrollLeft/n()*(a-t)+t},this.setValue=function(o){o<t&&(o=t),o>a&&(o=a),e.scrollLeft=n()*(o-t)/(a-t)}}function getSettings(){return new Promise(function(e){chrome.storage.local.get(["voiceName","rate","pitch","volume","spchletMaxLen","showHighlighting"],e)})}function updateSettings(e){return new Promise(function(n){chrome.storage.local.set(e,n)})}function clearSettings(){return new Promise(function(e){chrome.storage.local.remove(["voiceName","rate","pitch","volume","spchletMaxLen","showHighlighting"],e)})}function getState(e){return new Promise(function(n){chrome.storage.local.get(e,function(t){n(t[e])})})}function setState(e,n){var t={};return t[e]=n,new Promise(function(e){chrome.storage.local.set(t,e)})}function getVoices(){return new Promise(function(e){chrome.tts.getVoices(e)})}function isGoogleNative(e){return/^Google /.test(e)}function isGoogleTranslate(e){return/^GoogleTranslate /.test(e)}function isAmazonPolly(e){return/^Amazon /.test(e)}function isRemoteVoice(e){return isAmazonPolly(e)||isGoogleTranslate(e)}function executeFile(e){return new Promise(function(n,t){chrome.runtime.lastError=null,chrome.tabs.executeScript({file:e},function(e){chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):n(e)})})}function executeScript(e){return new Promise(function(n){chrome.runtime.lastError=null,chrome.tabs.executeScript({code:e},function(e){chrome.runtime.lastError?reject(new Error(chrome.runtime.lastError.message)):n(e)})})}function getBackgroundPage(){return new Promise(function(e){chrome.runtime.getBackgroundPage(e)})}function spread(e,n){return function(t){return e.apply(n,t)}}function callMethod(e,n){return function(t){return t[e].apply(t,n)}}function waitMillis(e){return new Promise(function(n){setTimeout(n,e)})}function parseLang(e){var n=e.toLowerCase().replace(/_/g,"-").split(/-/,2);return{lang:n[0],rest:n[1]}}function formatError(e){var n=chrome.i18n.getMessage(e.code);return n&&(n=n.replace(/{(\w+)}/g,function(n,t){return e[t]})),n}function connect(e){window.docReady||(window.docReady=makeDoc()),window.docReady.then(function(n){startService(e,n)})}function startService(e,n){function t(e,n){var t=n.request;if(e[t.method]){var a=e[t.method](t);Promise.resolve(a).then(function(e){s.postMessage({id:n.id,response:e})})}}function a(e){return{isPdf:n.isPdf,canSeek:n.canSeek,url:location.href,title:document.title,lang:document.documentElement.lang||$("html").attr("xml:lang")||$("meta[http-equiv=content-language]").attr("content")}}function o(e){return i()?-100:n.getCurrentIndex()}function r(e){return e.index<0?-100==e.index?i().split(/(?:\r?\n){2,}/):null:Promise.resolve(n.getTexts(e.index)).then(function(e){return e&&(e=e.map(removeLinks),console.log(e.join("\n\n"))),e})}function i(){return window.getSelection().toString().trim()}var s=chrome.runtime.connect({name:e});s.onMessage.addListener(t.bind(null,{raGetInfo:a,raGetCurrentIndex:o,raGetTexts:r}))}function makeDoc(){function e(){return"docs.google.com"==location.hostname?$(".kix-appview-editor").length?new GoogleDoc:$(".drive-viewer-paginated-scrollable").length?new GDriveDoc:new HtmlDoc:"drive.google.com"==location.hostname?new GDriveDoc:"read.amazon.com"==location.hostname?new KindleBook:location.pathname.match(/\.pdf$/)?new PdfDoc(location.href):$("embed[type='application/pdf']").length?new PdfDoc($("embed[type='application/pdf']").attr("src")):new HtmlDoc}return function(){return new Promise(function(e){$(e)})}().then(e).then(function(e){return Promise.resolve(e.ready).then(function(){return e})})}function GoogleDoc(){function e(){return $(".kix-paragraphrenderer",this).get().map(getText).filter(isNotEmpty)}var n=$(".kix-appview-editor").get(0),t=$(".kix-page");this.getCurrentIndex=function(){for(var e=0;e<t.length&&!(t.eq(e).position().top>n.scrollTop+$(n).height()/2);e++);return e-1},this.getTexts=function(a){var o=t.get(a);return o?(n.scrollTop=$(o).position().top,tryGetTexts(e.bind(o),2e3)):null}}function GDriveDoc(){function e(){return fixParagraphs($("p",this).get().map(getText).filter(isNotEmpty))}var n=$(".drive-viewer-paginated-scrollable").get(0),t=$(".drive-viewer-paginated-page");this.getCurrentIndex=function(){for(var e=0;e<t.length&&!(t.eq(e).position().top>n.scrollTop+$(n).height()/2);e++);return e-1},this.getTexts=function(a){var o=t.get(a);return o?(n.scrollTop=$(o).position().top,tryGetTexts(e.bind(o),3e3)):null}}function KindleBook(){function e(){var e=[];r.filter(function(e){return"hidden"!=e.style.visibility}).forEach(function(n){var t=$(n).height();$("h1, h2, h3, h4, h5, h6, .was-a-p",n.contentDocument).each(function(){var n=$(this).offset().top;$(this).height();n>=0&&n<t&&e.push($(this).text())})});for(var t=[],a=0;a<e.length;a++)e[a]!=(t.length?t[t.length-1]:n)&&t.push(e[a]);return n=t[t.length-1],t}var n,t=document.getElementById("KindleReaderIFrame").contentDocument,a=t.getElementById("kindleReader_pageTurnAreaRight"),o=t.getElementById("kindleReader_pageTurnAreaLeft"),r=[t.getElementById("column_0_frame_0"),t.getElementById("column_0_frame_1"),t.getElementById("column_1_frame_0"),t.getElementById("column_1_frame_1")],i=0;this.getCurrentIndex=function(){return i=0},this.getTexts=function(n){for(;i<n;i++)$(a).click();for(;i>n;i--)$(o).click();return tryGetTexts(e,4e3)}}function PdfDoc(e){function n(e){return e.getTextContent().then(function(e){return e.items.map(function(e){return e.str.trim()}).filter(isNotEmpty)}).then(fixParagraphs)}function t(){return a?Promise.resolve():(PDFJS.workerSrc=chrome.runtime.getURL("/js/pdf.worker.js"),PDFJS.getDocument(e).promise.then(function(e){a=e}))}var a;this.isPdf=!0,this.canSeek=!0,this.getCurrentIndex=function(){return 0},this.getTexts=function(e){return t().then(function(){return e<a.numPages?a.getPage(e+1).then(n):null})}}function HtmlDoc(){function e(){$(".read-aloud").removeClass("read-aloud");var e=$("p").not("blockquote > p").parent().get();if($.uniqueSort(e),e=$(e).filter(":visible").filter(notOutOfView).get(),e.length){var t=e.map(function(e){return $(e).children(r.join(", ")).text().length}),a=Math.max.apply(null,t);e=e.filter(function(e,n){return t[n]>a/7}),e.forEach(function(e){$(n(e)).addClass("read-aloud"),$(e).children(o.concat(r).join(", ")).addClass("read-aloud"),$(e).children(i.join(", ")).children("li").addClass("read-aloud")})}else $(o.concat(r).join(", ")).filter(":visible").addClass("read-aloud");return $(".read-aloud").get().map(getText).filter(isNotEmpty)}function n(e){for(var n=[],i=$(e).children(o.concat(r).join(", ")).get(0),s=t(i),l=a(i,!0);l&&!$(l).hasClass("read-aloud");){if(1==l.nodeType){var c=t(l);c<s&&(n.push(l),s=c)}l=a(l)}return n.reverse()}function t(e){var n=e?o.indexOf(e.tagName):-1;return-1==n?100:n+1}function a(e,n){return e==document.body?null:1==e.nodeType&&!n&&e.lastChild?e.lastChild:e.previousSibling?e.previousSibling:a(e.parentNode,!0)}var o=["H1","H2","H3","H4","H5","H6"],r=["P","BLOCKQUOTE","PRE"],i=["OL","UL"];this.getCurrentIndex=function(){return 0},this.getTexts=function(n){return 0==n?e():null}}function notOutOfView(){return $(this).offset().left>=0}function getText(e){$(e).find(":hidden, sup").remove();var n=$(e).text().trim();return"LI"==e.tagName?$(e).index()+1+". "+n:n}function isNotEmpty(e){return e}function removeLinks(e){return e.replace(/https?:\/\/\S+/g,"this URL.")}function waitMillis(e){return new Promise(function(n){setTimeout(n,e)})}function fixParagraphs(e){for(var n=[],t="",a=0;a<e.length;a++)t&&(/-$/.test(t)?t=t.substr(0,t.length-1):t+=" "),t+=e[a].replace(/-\r?\n/g,""),e[a].match(/[.!?:)"'\u2019\u201d]$/)&&(n.push(t),t="");return t&&n.push(t),n}function tryGetTexts(e,n){return waitMillis(500).then(e).then(function(t){return t&&!t.length&&n-500>0?tryGetTexts(e,n-500):t})}function Speech(e,n){function t(){return new Promise(function(e){f.isSpeaking(function(n){e(_?n?"PLAYING":"LOADING":"PAUSED")})})}function a(){return{index:y,texts:e}}function o(){return y[0]>=e.length?(n.hack&&clearTimeout(T),_=!1,n.onEnd&&n.onEnd(),Promise.resolve()):(n.hack&&(clearTimeout(T),T=setTimeout(r,16*1e3)),_=(new Date).getTime(),new Promise(function(n){g(e[y[0]][y[1]],n,i)}))}function r(){f.isSpeaking(function(e){e&&i()})}function i(){return y[1]++,y[1]>=e[y[0]].length&&(y=[y[0]+1,0]),o()}function s(){return n.hack&&clearTimeout(T),f.stop(),_=!1,Promise.resolve()}function l(){return y[0]+1<e.length?(y=[y[0]+1,0],o()):Promise.reject(new Error("Can't forward, at end"))}function c(){return _&&(new Date).getTime()-_>3*1e3?(y=[y[0],0],o()):y[0]>0?(y=[y[0]-1,0],o()):Promise.reject(new Error("Can't rewind, at beginning"))}function u(){y=[Math.max(e.length-1,0),0]}function g(e,t,a){f.speak(e,{voiceName:n.voiceName,lang:n.lang,rate:n.rate,pitch:n.pitch,volume:n.volume,requiredEventTypes:["start","end"],desiredEventTypes:["start","end"],onEvent:function(e){"start"==e.type?t():"end"==e.type&&a()}})}function m(){function e(e,t,o){return a(o.getSentences(e),t,o,n)}function n(e,n,o){return a(o.getPhrases(e),n,o,t)}function t(e,n,t){for(var a=t.getWords(e),o=Math.min(Math.ceil(a.length/2),n),r=[];a.length;)r.push(a.slice(0,o).join("")),a=a.slice(o);return r}function a(e,n,t,a){var o=[],r={parts:[],wordCount:0},i=function(){r.parts.length&&(o.push(r.parts.join("")),r={parts:[],wordCount:0})};return e.forEach(function(e){var s=t.getWords(e).length;if(s>n){i();for(var l=a(e,n,t),c=0;c<l.length;c++)o.push(l[c])}else r.wordCount+s>n&&i(),r.parts.push(e),r.wordCount+=s}),i(),o}this.breakText=e}function d(){function e(e,t,o){return a(o.getSentences(e),t,o,n)}function n(e,n,o){return a(o.getPhrases(e),n,o,t)}function t(e,n,t){return a(t.getWords(e),n,t)}function a(e,n,t,a){var o=[],r={parts:[],charCount:0},i=function(){r.parts.length&&(o.push(r.parts.join("")),r={parts:[],charCount:0})};return e.forEach(function(e){var s=e.length;if(s>n){i();for(var l=a(e,n,t),c=0;c<l.length;c++)o.push(l[c])}else r.charCount+s>n&&i(),r.parts.push(e),r.charCount+=s}),i(),o}this.breakText=e}function p(){this.getSentences=function(e){for(var n=e.split(/([.!?]+[\s\u200b])/),t=[],a=0;a<n.length;a+=2)a+1<n.length?t.push(n[a]+n[a+1]):t.push(n[a]);return t},this.getPhrases=function(e){for(var n=e.split(/([,;:]\s|\s-+\s|—)/),t=[],a=0;a<n.length;a+=2)a+1<n.length?t.push(n[a]+n[a+1]):t.push(n[a]);return t},this.getWords=function(e){for(var n=e.trim().split(/([~@#%^*_+=<>]|[\s\-—\/]+|\.(?=\w{2,})|,(?=[0-9]))/),t=[],a=0;a<n.length;a+=2)n[a]&&t.push(n[a]),a+1<n.length&&(/^[~@#%^*_+=<>]$/.test(n[a+1])?t.push(n[a+1]):t.length&&(t[t.length-1]+=n[a+1]));return t}}function h(){this.getSentences=function(e){for(var n=e.split(/([.!?]+[\s\u200b]|[\u3002\uff01])/),t=[],a=0;a<n.length;a+=2)a+1<n.length?t.push(n[a]+n[a+1]):t.push(n[a]);return t},this.getPhrases=function(e){for(var n=e.split(/([,;:]\s|[\u2025\u2026\u3000\u3001\uff0c\uff1b])/),t=[],a=0;a<n.length;a+=2)a+1<n.length?t.push(n[a]+n[a+1]):t.push(n[a]);return t},this.getWords=function(e){return e.replace(/\s+/g,"").split("")}}n.spchletMaxLen||(n.spchletMaxLen=36),n.rate||(n.rate=1);var v;/^zh|ko|ja/.test(n.lang)?(v=new h,n.spchletMaxLen*=2):v=new p;var f=n.engine||chrome.tts,_=!1,y=[0,0],T=0;isAmazonPolly(n.voiceName)||isGoogleTranslate(n.voiceName)?(e=e.map(function(e){return(new d).breakText(e,200,v)}),n.hack=!1):isGoogleNative(n.voiceName)?(e=e.map(function(e){return(new m).breakText(e,n.spchletMaxLen*n.rate,v)}),n.hack=!0):(e=e.map(function(e){return[e]}),n.hack=!1),this.options=n,this.play=o,this.pause=s,this.getState=t,this.getPosition=a,this.forward=l,this.rewind=c,this.gotoEnd=u}function RemoteTTS(e){function n(e){return isGoogleTranslate(e)?1.2:1}var t=window.ttsAudio;t||(t=window.ttsAudio=document.createElement("AUDIO")),this.speak=function(a,o,r){r||(r=o.onEvent),t.pause(),t.volume=o.volume||1,t.defaultPlaybackRate=(o.rate||1)*n(o.voiceName),t.src=e+"/read-aloud/speak/"+o.lang+"/"+encodeURIComponent(o.voiceName)+"?q="+encodeURIComponent(a),t.onplay=r.bind(null,{type:"start",charIndex:0}),t.onerror=t.onended=r.bind(null,{type:"end",charIndex:a.length}),t.play()},this.isSpeaking=function(e){e(t.currentTime&&!t.paused&&!t.ended)},this.stop=function(){t.pause()}}var remoteVoices=[{voice_name:"Amazon US English (Joanna)",lang:"en-US",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Japanese (Mizuki)",lang:"ja-JP",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Turkish (Filiz)",lang:"tr-TR",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Swedish (Astrid)",lang:"sv-SE",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Russian (Maxim)",lang:"ru-RU",gender:"male",event_types:["start","end"]},{voice_name:"Amazon Russian (Tatyana)",lang:"ru-RU",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Romanian (Carmen)",lang:"ro-RO",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Portuguese (Ines)",lang:"pt-PT",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Portuguese (Cristiano)",lang:"pt-PT",gender:"male",event_types:["start","end"]},{voice_name:"Amazon Brazilian Portuguese (Vitoria)",lang:"pt-BR",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Brazilian Portuguese (Ricardo)",lang:"pt-BR",gender:"male",event_types:["start","end"]},{voice_name:"Amazon Polish (Maja)",lang:"pl-PL",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Polish (Jan)",lang:"pl-PL",gender:"male",event_types:["start","end"]},{voice_name:"Amazon Polish (Ewa)",lang:"pl-PL",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Dutch (Ruben)",lang:"nl-NL",gender:"male",event_types:["start","end"]},{voice_name:"Amazon Dutch (Lotte)",lang:"nl-NL",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Norwegian (Liv)",lang:"nb-NO",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Italian (Giorgio)",lang:"it-IT",gender:"male",event_types:["start","end"]},{voice_name:"Amazon Italian (Carla)",lang:"it-IT",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Icelandic (Karl)",lang:"is-IS",gender:"male",event_types:["start","end"]},{voice_name:"Amazon Icelandic (Dora)",lang:"is-IS",gender:"female",event_types:["start","end"]},{voice_name:"Amazon French (Mathieu)",lang:"fr-FR",gender:"male",event_types:["start","end"]},{voice_name:"Amazon French (Celine)",lang:"fr-FR",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Canadian French (Chantal)",lang:"fr-CA",gender:"female",event_types:["start","end"]},{voice_name:"Amazon US Spanish (Penelope)",lang:"es-US",gender:"female",event_types:["start","end"]},{voice_name:"Amazon US Spanish (Miguel)",lang:"es-US",gender:"male",event_types:["start","end"]},{voice_name:"Amazon Castilian Spanish (Enrique)",lang:"es-ES",gender:"male",event_types:["start","end"]},{voice_name:"Amazon Castilian Spanish (Conchita)",lang:"es-ES",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Welsh English (Geraint)",lang:"en-GB-WLS",gender:"male",event_types:["start","end"]},{voice_name:"Amazon US English (Salli)",lang:"en-US",gender:"female",event_types:["start","end"]},{voice_name:"Amazon US English (Kimberly)",lang:"en-US",gender:"female",event_types:["start","end"]},{voice_name:"Amazon US English (Kendra)",lang:"en-US",gender:"female",event_types:["start","end"]},{voice_name:"Amazon US English (Justin)",lang:"en-US",gender:"male",event_types:["start","end"]},{voice_name:"Amazon US English (Joey)",lang:"en-US",gender:"male",event_types:["start","end"]},{voice_name:"Amazon US English (Ivy)",lang:"en-US",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Indian English (Raveena)",lang:"en-IN",gender:"female",event_types:["start","end"]},{voice_name:"Amazon British English (Emma)",lang:"en-GB",gender:"female",event_types:["start","end"]},{voice_name:"Amazon British English (Brian)",lang:"en-GB",gender:"male",event_types:["start","end"]},{voice_name:"Amazon British English (Amy)",lang:"en-GB",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Australian English (Russell)",lang:"en-AU",gender:"male",event_types:["start","end"]},{voice_name:"Amazon Australian English (Nicole)",lang:"en-AU",gender:"female",event_types:["start","end"]},{voice_name:"Amazon German (Marlene)",lang:"de-DE",gender:"female",event_types:["start","end"]},{voice_name:"Amazon German (Hans)",lang:"de-DE",gender:"male",event_types:["start","end"]},{voice_name:"Amazon Danish (Naja)",lang:"da-DK",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Danish (Mads)",lang:"da-DK",gender:"male",event_types:["start","end"]},{voice_name:"Amazon Welsh (Gwyneth)",lang:"cy-GB",gender:"female",event_types:["start","end"]},{voice_name:"Amazon Polish (Jacek)",lang:"pl-PL",gender:"male",event_types:["start","end"]},{voice_name:"GoogleTranslate Afrikaans",lang:"af",event_types:["start","end"]},{voice_name:"GoogleTranslate Albanian",lang:"sq",event_types:["start","end"]},{voice_name:"GoogleTranslate Arabic",lang:"ar",event_types:["start","end"]},{voice_name:"GoogleTranslate Armenian",lang:"hy",event_types:["start","end"]},{voice_name:"GoogleTranslate Bengali",lang:"bn",event_types:["start","end"]},{voice_name:"GoogleTranslate Bosnian",lang:"bs",event_types:["start","end"]},{voice_name:"GoogleTranslate Catalan",lang:"ca",event_types:["start","end"]},{voice_name:"GoogleTranslate Chinese",lang:"zh-CN",event_types:["start","end"]},{voice_name:"GoogleTranslate Croatian",lang:"hr",event_types:["start","end"]},{voice_name:"GoogleTranslate Czech",lang:"cs",event_types:["start","end"]},{voice_name:"GoogleTranslate Danish",lang:"da",event_types:["start","end"]},{voice_name:"GoogleTranslate Dutch",lang:"nl",event_types:["start","end"]},{voice_name:"GoogleTranslate English",lang:"en",event_types:["start","end"]},{voice_name:"GoogleTranslate Esperanto",lang:"eo",event_types:["start","end"]},{voice_name:"GoogleTranslate Finnish",lang:"fi",event_types:["start","end"]},{voice_name:"GoogleTranslate French",lang:"fr",event_types:["start","end"]},{voice_name:"GoogleTranslate German",lang:"de",event_types:["start","end"]},{voice_name:"GoogleTranslate Greek",lang:"el",event_types:["start","end"]},{voice_name:"GoogleTranslate Hindi",lang:"hi",event_types:["start","end"]},{voice_name:"GoogleTranslate Hungarian",lang:"hu",event_types:["start","end"]},{voice_name:"GoogleTranslate Icelandic",lang:"is",event_types:["start","end"]},{voice_name:"GoogleTranslate Indonesian",lang:"id",event_types:["start","end"]},{voice_name:"GoogleTranslate Italian",lang:"it",event_types:["start","end"]},{voice_name:"GoogleTranslate Japanese",lang:"ja",event_types:["start","end"]},{voice_name:"GoogleTranslate Khmer",lang:"km",event_types:["start","end"]},{voice_name:"GoogleTranslate Korean",lang:"ko",event_types:["start","end"]},{voice_name:"GoogleTranslate Latin",lang:"la",event_types:["start","end"]},{voice_name:"GoogleTranslate Latvian",lang:"lv",event_types:["start","end"]},{voice_name:"GoogleTranslate Macedonian",lang:"mk",event_types:["start","end"]},{voice_name:"GoogleTranslate Nepali",lang:"ne",event_types:["start","end"]},{voice_name:"GoogleTranslate Norwegian",lang:"no",event_types:["start","end"]},{voice_name:"GoogleTranslate Polish",lang:"pl",event_types:["start","end"]},{voice_name:"GoogleTranslate Portuguese",lang:"pt",event_types:["start","end"]},{voice_name:"GoogleTranslate Romanian",lang:"ro",event_types:["start","end"]},{voice_name:"GoogleTranslate Russian",lang:"ru",event_types:["start","end"]},{voice_name:"GoogleTranslate Serbian",lang:"sr",event_types:["start","end"]},{voice_name:"GoogleTranslate Sinhala",lang:"si",event_types:["start","end"]},{voice_name:"GoogleTranslate Slovak",lang:"sk",event_types:["start","end"]},{voice_name:"GoogleTranslate Spanish",lang:"es",event_types:["start","end"]},{voice_name:"GoogleTranslate Swahili",lang:"sw",event_types:["start","end"]},{voice_name:"GoogleTranslate Swedish",lang:"sv",event_types:["start","end"]},{voice_name:"GoogleTranslate Tamil",lang:"ta",event_types:["start","end"]},{voice_name:"GoogleTranslate Thai",lang:"th",event_types:["start","end"]},{voice_name:"GoogleTranslate Turkish",lang:"tr",event_types:["start","end"]},{voice_name:"GoogleTranslate Ukrainian",lang:"uk",event_types:["start","end"]},{voice_name:"GoogleTranslate Vietnamese",lang:"vi",event_types:["start","end"]},{voice_name:"GoogleTranslate Welsh",lang:"cy",event_types:["start","end"]}],config={serviceUrl:"https://support.lsdsoftware.com"},defaults={rate:1,pitch:1,volume:1,spchletMaxLen:36,minSpchletMaxLen:10,maxSpchletMaxLen:500,showHighlighting:0};!function(){if(window.chrome&&chrome.ttsEngine){var e=new RemoteTTS(config.serviceUrl);chrome.ttsEngine.onSpeak.addListener(e.speak),chrome.ttsEngine.onStop.addListener(e.stop)}}();var readAloud=new function(){function e(){return n().then(function(e){$(".ra-play").toggle(!e),$(".ra-pause").toggle(e),s.toggle(e&&isGoogleTranslate(r.options.voiceName))})}function n(){return r?r.getState().then(function(e){return"PAUSED"!=e}):Promise.resolve(!1)}function t(){function e(e,n){var t=parseLang(n),a={};return e.forEach(function(e){if(e.lang){var n=parseLang(e.lang);n.lang==t.lang&&(n.rest==t.rest?"female"==e.gender?a.first=a.first||e:a.second=a.second||e:n.rest?"en"==n.lang&&"us"==n.rest?a.fourth=e:a.fourth=a.fourth||e:a.third=a.third||e)}}),a.first||a.second||a.third||a.fourth}window.speechSynthesis&&speechSynthesis.getVoices(),this.getLocalVoice=function(n){return window.speechSynthesis?e(speechSynthesis.getVoices(),n):null},this.getRemoteVoice=function(n){return window.remoteVoices?e(remoteVoices.filter(function(e){return isAmazonPolly(e.voice_name)}),n)||e(remoteVoices.filter(function(e){return isGoogleTranslate(e.voice_name)}),n):null}}function a(e){var n;this.speak=function(t,a){n=new SpeechSynthesisUtterance,a.lang&&(n.lang=a.lang),a.pitch&&(n.pitch=a.pitch),a.rate&&(n.rate=a.rate),n.text=t,n.voice=e,a.volume&&(n.volume=a.volume),n.onstart=a.onEvent.bind(null,{type:"start",charIndex:0}),n.onerror=n.onend=a.onEvent.bind(null,{type:"end",charIndex:t.length}),speechSynthesis.speak(n)},this.isSpeaking=function(e){e(speechSynthesis.speaking)},this.stop=function(){n&&(n.onend=null),speechSynthesis.cancel()}}function o(){var e=$("<div/>").get(0);$("<div>powered&nbsp;by</div>").css({color:"#888","margin-bottom":"3px"}).appendTo(e),$("<span>G</span>").css("color","#4885ed").appendTo(e),$("<span>o</span>").css("color","#db3236").appendTo(e),$("<span>o</span>").css("color","#f4c20d").appendTo(e),$("<span>g</span>").css("color","#4885ed").appendTo(e),$("<span>l</span>").css("color","#3cba54").appendTo(e),$("<span>e</span>").css("color","#db3236").appendTo(e),$("<span>&nbsp;Translate</span>").css("color","#888").appendTo(e),$(e).css({display:"none",position:"absolute",padding:"6px",color:"black","background-color":"white","border-radius":"3px","box-shadow":"1px 1px 3px gray","font-family":"Arial, Helvetica, sans-serif","font-size":"small","text-align":"center",cursor:"pointer"}).click(function(){window.open("https://translate.google.com/","_blank")}),$(function(){$(e).appendTo(document.body)}),this.toggle=function(n){if(n){var t=$(".ra-pause").offset();t&&(t.left=Math.max(0,t.left+$(".ra-pause").outerWidth()/2-$(e).outerWidth()/2),t.top+=$(".ra-pause").height()+5,$(e).css(t).show())}else $(e).hide()}}var r,i=new t,s=new o;this.play=function(n){return r?r.play().then(e):this.speak((new HtmlDoc).getTexts(0),n)},this.speak=function(n,t){if(!window.Promise)return alert("Browser not supported");var o=i.getLocalVoice(t.lang);return o?(t.voiceName=o.name,t.engine=new a(o)):(o=i.getRemoteVoice(t.lang),t.voiceName=o?o.voice_name:"default",t.engine=new RemoteTTS(config.serviceUrl)),t.onEnd=function(){r=null,e()},r&&r.pause(),r=new Speech(n,t),r.play().then(e)},this.pause=function(){return r?r.pause().then(e):Promise.resolve()},this.isPlaying=n,$(e)};